<form class="row g-1 class card p-3 shadow" novalidate [formGroup]="inputForm" (ngSubmit)="getDataForm()">
<!-- First Name -->
  <div class="row g-2">
    <div class="col-md-3  label">
      <label for="first_name" class="form-label mb-0">Nombre *</label>
    </div>
    <div class="col-md-9">
      <input type="text" class="form-control" id="first_name" formControlName="first_name" maxlength="45"  placeholder="Miguel" required>
      @if (checkControl ('first_name','required')) {
        <p class="error-msg">Campo obligatorio</p>
      }
      @if (checkControl ('first_name','pattern')) {
        <p class="error-msg">Nombre invàlido</p>
      }
    </div>
  </div>

<!-- Last Name -->
  <div class="row g-2">
    <div class="col-md-3 label">
      <label for="last_name" class="form-label mb-0">Apellidos *</label>
    </div>
    <div class="col-md-9">
      <input type="text" class="form-control" id="last_name" formControlName="last_name" placeholder="de Cervantes Saavedra" maxlength="45"  required>
      @if (checkControl ('last_name','required')) {
        <p class="error-msg">Campo obligatorio</p>
      }
      @if (checkControl ('last_name','pattern')) {
        <p class="error-msg">Nombre invàlido</p>
      }
    </div>
  </div>
<!-- Username -->
  <div class="row g-2">
    <div class="col-md-3 label">
      <label for="username" class="form-label mb-0">Username *</label>
    </div>
    <div class="col-md-9">
      <div class="input-group has-validation">
        <span class="input-group-text" id="inputGroupPrepend">&#64;</span>
        <input type="text" class="form-control" id="username" formControlName="username" placeholder="MiguelDeCervantes_1547"  maxlength="45" required (input)="checkUsername ($event)">
        
      </div>
      @if (this.usernameExists){
        <p class="error-msg">Uix, alguien ya ha cojido este nombre de usuario!</p>
      }
      @if (checkControl ('username','required')) {
        <p class="error-msg">Campo obligatorio</p>
      }
      @if (checkControl ('username','pattern')) {
        <p class="error-msg">Debe contener por lo menos 4 números, letras o carácteres especiales sin espacios</p>
      }
    </div>
  </div>

<!-- Telephone -->
  <div class="row g-2">
    <div class="col-md-3  label">
      <label for="telephone" class="form-label mb-0">Teléfono</label>
    </div>
    <div class="col-md-9">
      <div class="row">
        <div  class="col-md-4">
          <select class="form-select" id="country_code"  formControlName="country_code">
            <option selected disabled value="">País...</option>
            @for (code of arrInternationalCodes; track $index) {
              <option value="{{code.code}}">{{code.name}} ({{code.code}})</option>
            }
          </select>
        </div>
        <div class="col-md-8">
          <input type="text" class="form-control" id="telephone" formControlName="telephone" placeholder="123456789"  maxlength="20">
        </div>
      </div>
    </div>
  </div>

<!-- email -->
  <div class="row g-2">
    <div class="col-md-3 label">
      <label for="email" class="form-label mb-0">Correo electrónico *</label>
    </div>
    <div class="col-md-9">
      <input type="text" class="form-control" id="email" formControlName="email" placeholder="miguel_de_cervantes@email.es"  maxlength="45" required>
      @if (checkControl ('email','required')) {
        <p class="error-msg">Campo obligatorio</p>
      }
      @if (checkControl ('email','pattern')) {
        <p class="error-msg">Correo invàlido</p>
      }
    </div>

  </div>

  @if (!this.isUpdate) {
      <!-- Password -->
    <div class="row g-2">
      <div class="col-md-3 label">
        <label for="password" class="form-label mb-0">Contraseña *</label>
      </div>
      <div class="col-md-9">
        <input type="password" class="form-control" id="password" formControlName="password"  maxlength="30" required>
        @if (checkControl ('password','required')) {
          <p class="error-msg">Campo obligatorio</p>
        }
      </div>
    </div>

  <!-- Confirm password -->
    <div class="row g-2">
      <div class="col-md-3 label">
        <label for="password_confirm" class="form-label mb-0">Confirmar contraseña *</label>
      </div>
      <div class="col-md-9">
        <input type="password" class="form-control" id="password_confirm" formControlName="password_confirm" required>
        @if (inputForm.hasError('passwordControl')){
          <p class="error-msg">Las contraseñas no coinciden</p>
        }
      </div>
    </div>}

  <div class="row g-1 mt-4  g-3">
  <!-- Form de registro: enlace a login y botón submit -->
  @if (!isUpdate) {
    <div class="col-12 col-md-8">
      <p class="mb-0">¿Ya tienes una cuenta? <a href="">Accede</a> </p> 
    </div>
    <div class="col-12 col-md-4 mt-2 mt-md-0 pe-0">
      
      <input class="btn btn-outline-dark w-100" type="submit" [disabled]="!inputForm.valid" value="Regístrate" >
    </div>
  } @else {
    <!-- Form de update: botón al modal change-pwd-modal y validar datos-->
    <div class="col-12 col-lg-4  col-sm-0 mt-2 mt-md-0 pe-0">
    </div>
    <div class="col-12 col-lg-4 col-md-6  col-sm-6 mt-2 mt-md-0 pe-0">
      <button  type="button" class="btn btn-outline-warning w-100" data-bs-toggle="modal" data-bs-target="#changePwdModal"> Modificar contraseña </button>
      <app-change-pwd-modal></app-change-pwd-modal>
    </div>

    <div class="col-12 col-lg-4 col-md-6  col-sm-6 mt-2 mt-md-0 pe-0">
      <input  type="submit"  class="btn btn-outline-dark w-100"[disabled]="!inputForm.valid" value="Actualizar" >
    </div>
  }
</div>
</form>

<a href=""></a>
<b></b>